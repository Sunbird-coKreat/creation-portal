<div class="ui container pb-48">
  <div class="sb-pageSection my-24">
    <div class="d-flex flex-ai-center flex-jc-space-between">
      <div class="sb-pageSection-header mb-0">
        <h4 class="sb-pageSection-title">
          <span *ngIf="!isContributor || activeMyProgramsMenu">{{ resourceService.frmelmnts.lbl.myPrograms }} </span>
          <span *ngIf="activeAllProgramsMenu">{{ resourceService.frmelmnts.lbl.explorePrograms }} </span>
          <span class="sb-pagSection-count sb-label sb-label-x sb-label-warning ml-8 px-8"
            *ngIf="programs && programs.length">{{count}}</span></h4>
      </div>
      <!-- <button routerLink="sourcing/create-program" *ngIf="this.router.url.includes('/sourcing')" class="sb-btn sb-btn-normal sb-btn-primary"><i class="plus outline icon"></i> Add New Program</button> -->
    </div>
    <div class="sb-pageSection-content mt-12">
      <ng-container *ngIf="programs !== undefined else loading">
        <ng-container *ngIf="programs.length else noResult">
          <div class="sb-table-responsive">
            <table class="sb-table sb-table-striped sb-table-sortable sb-table-nowrap">
            <thead class="sb-table-header sb-table-thead-gray">
              <tr>
                <th class="w-20 sb-sort-icon" (click)="sort('name')">{{ resourceService.frmelmnts.lbl.program }}</th>
                <th *ngIf="isContributor" class="w-20 sb-sort-icon" (click)="sort('sourcing_org_name')" >{{ resourceService.frmelmnts.lbl.orgName }}</th>
                <th class="w-15">{{ resourceService.frmelmnts.lbl.contentType }}</th>
                <th class="w-15">{{ resourceService.frmelmnts.lbl.MediumClassSubject }}</th>
                <th *ngIf="!isContributor" class="w-10">{{ resourceService.frmelmnts.lbl.programDates }}</th>
                <th *ngIf="activeMyProgramsMenu" class="sb-sort-icon w-10">{{ resourceService.frmelmnts.lbl.nominatedDate }}</th>
                <th *ngIf="activeAllProgramsMenu" class="w-10">{{ resourceService.frmelmnts.lbl.programDates }}</th>
                <th *ngIf="activeMyProgramsMenu" class="w-5 text-center">{{ resourceService.frmelmnts.lbl.status }}</th>
                <th class="w-5 text-center"> {{ resourceService.frmelmnts.lbl.actions }}</th>
              </tr>
            </thead>
            <tbody class="sb-table-body">
              <tr *ngFor="let program of programs; let i = index;">
                <td>
                  <div class="sb__ellipsis sb__ellipsis--three sb-color-primary font-weight-bold">
                    {{program?.name}}
                  </div>
                  <div class="sb__ellipsis sb__ellipsis--three">{{ getProgramTextbooksCount(program) }}</div>
                  <div *ngIf="activeMyProgramsMenu" class="sb-label-value mt-4">{{ getProgramInfo(program, 'board') }}</div>
                </td>
                <td *ngIf="isContributor" >
                  <div>{{ getSourcingOrgName(program) }}
                  </div>
                </td>
                <td>
                  <div class="sb__ellipsis sb__ellipsis--breakAll" style="width: 200px;" suiPopup  popupDelay="1000" popupHeader="{{ resourceService.frmelmnts.lbl.contentType }}" popupText="{{ getProgramContentTypes(program) }}">{{ getProgramContentTypes(program) }}</div>
                </td>
                <td>
                  <div class="sb__ellipsis sb__ellipsis--breakAll" suiPopup  popupDelay="1000" popupHeader="{{ resourceService.frmelmnts.lbl.mediums }}" popupText="{{ getProgramInfo(program, 'medium') }}">{{ getProgramInfo(program, 'medium') }}</div>
                  <hr class="divider">

                  <div class="sb__ellipsis sb__ellipsis--breakAll" suiPopup  popupDelay="1000" popupHeader="{{ resourceService.frmelmnts.lbl.class }}" popupText="{{ getProgramInfo(program, 'gradeLevel') }}">{{ getProgramInfo(program, 'gradeLevel') }}</div>
                  <hr class="divider">
                  <div class="sb__ellipsis sb__ellipsis--breakAll" suiPopup  popupDelay="1000" popupHeader="{{ resourceService.frmelmnts.lbl.subjects }}" popupText="{{ getProgramInfo(program, 'subject') }}">{{ getProgramInfo(program, 'subject') }}</div>
                </td>

                <td *ngIf="!isContributor || activeAllProgramsMenu" class="nowrap">
                  <div class="program-timeline">
                    <div class="program-timeline-item">
                      <div class="status" [class.active]="isActive(program, 'nomination_enddate', i)">
                        <div class="status__label">{{ resourceService.frmelmnts.lbl.nominationSubmission }}</div>
                        <div class="status__date">
                          {{ program?.nomination_enddate | date:'LLLL d, yyyy'  }}
                          <em class="d-block" *ngIf="isActive(program, 'nomination_enddate', i)" [class.sb-color-warning]="isActive(program, 'nomination_enddate', i)">{{ program?.nomination_enddate | daysToGo  }}</em>
                        </div>
                      </div>
                    </div>
                         <div class="program-timeline-item">
                      <div class="status" [class.active]="isActive(program, 'shortlisting_enddate', i)">
                        <div class="status__label">{{ resourceService.frmelmnts.lbl.shortlistingNomination }}</div>
                        <div class="status__date">
                          {{ program?.shortlisting_enddate | date:'LLLL d, yyyy'  }}
                          <em class="d-block" *ngIf="isActive(program, 'shortlisting_enddate', i)" [class.sb-color-warning]="isActive(program, 'shortlisting_enddate', i)">{{ program?.shortlisting_enddate | daysToGo  }}</em>
                        </div>
                      </div>
                    </div>
                    <div class="program-timeline-item">
                      <div class="status" [class.active]="isActive(program, 'content_submission_enddate', i)">
                        <div class="status__label">{{ resourceService.frmelmnts.lbl.contributions }}</div>
                        <div class="status__date">
                          {{ program?.content_submission_enddate | date:'LLLL d, yyyy'  }}
                          <em class="d-block" *ngIf="isActive(program, 'content_submission_enddate', i)" [class.sb-color-warning]="isActive(program, 'content_submission_enddate', i)">{{ program?.content_submission_enddate | daysToGo  }}</em>
                        </div>
                      </div>
                    </div>
                    <div class="program-timeline-item" *ngIf="!isContributor">
                      <div class="status" [class.active]="isActive(program, 'enddate', i)">
                        <div class="status__label">{{ resourceService.frmelmnts.lbl.programEndDate }}</div>
                        <div class="status__date">
                          {{ program?.enddate | date:'LLLL d, yyyy' }}
                          <em class="d-block" *ngIf="isActive(program, 'enddate', i)" [class.sb-color-warning]="isActive(program, 'enddate', i)">{{ program?.enddate | daysToGo }}</em>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
                <td *ngIf="activeMyProgramsMenu">
                  <div>
                    {{ program?.contributionDate | date:'LLLL d, yyyy' }}
                    <em class="d-block">{{ program?.contributionDate | daysToGo }}</em>
                  </div>
                </td>
                <td *ngIf="activeMyProgramsMenu" class="text-center">
                  <span class="sb-label sb-label-table sb-label-primary-100">{{ getProgramNominationStatus(program) }}</span>
                </td>
                <td class="text-center">
                    <button type="button" class="sb-btn sb-btn-normal sb-btn-outline-primary" *ngIf="!isContributor" (click)="viewDetailsBtnClicked(program)">{{ resourceService.frmelmnts.lbl.open }}</button>
                    <div class="ui dropdown sb-btn sb-btn-normal sb-btn-outline-primary sb-btn-dropdown" suiDropdown autoClose="itemClick" *ngIf="isContributor">
                        <div class="text">{{ resourceService.frmelmnts.lbl.actions }}</div>
                        <i class="dropdown icon"></i>
                        <div class="menu" suiDropdownMenu>
                          <div class="item" (click)="viewDetailsBtnClicked(program)">{{ resourceService.frmelmnts.lbl.open }}</div>
                          <div class="item" (click)="getContributionOrgUsers(program)" *ngIf="activeMyProgramsMenu && userService?.userProfile?.userRegData?.User_Org?.orgId">{{ resourceService.frmelmnts.lbl.assignRole }}</div>
                        </div>
                    </div>
                  </td>
              </tr>
              </tbody>
            </table>
          </div>
        </ng-container>
        <ng-template #noResult>
          <app-no-result [data]="{messageText: resourceService.messages.stmsg.m0006}"></app-no-result>
        </ng-template>
      </ng-container>
      <ng-template #loading>
        <app-loader></app-loader>
      </ng-template>
    </div>
  </div>
</div>
<sui-modal *ngIf="showAssignRoleModal" [mustScroll]="true" [isClosable]="true" [transitionDuration]="0"
  [size]="'normal'" class="sb-modal" appBodyScroll (dismissed)="showAssignRoleModal = !showAssignRoleModal" #modal>
  <div class="sb-modal-header">
    Set Role
  </div>
  <div class="sb-modal-content">
    <table class="sb-table sb-table-striped sb-table-hover sb-table-sortable sb-table-fixed">
      <thead class="sb-table-header sb-table-thead-gray">
        <tr>
          <th>Username</th>
          <th>Assign Role</th>
        </tr>
      </thead>
      <tbody class="sb-table-body">
        <tr *ngFor="let user of contributorOrgUser; let i = index">
          <td>{{user.firstName +' '+ user.lastName}}</td>
          <td>
            <ng-template let-option #optionTemplate>
              <div class="field m-0">
                <div class="template-checkbox">
                  <div class="p-5 option-text" title="{{option.name}}">
                    {{option.name}}
                  </div>
                  <div class="ml-auto">
                    <i class="square outline medium icon"></i>
                  </div>
                </div>
              </div>
            </ng-template>
            <sui-select class="selection" [(ngModel)]="user.selectedRole" labelField="name" [options]="options" valueField="name">
              <sui-select-option *ngFor="let option of roles;" [value]="option">
              </sui-select-option>
            </sui-select>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="sb-modal-actions">
    <button
      class="sb-btn sb-btn-normal sb-btn-success"
      (click)="assignRolesToOrgUsers();"
    >
      Submit
    </button>
  </div>
</sui-modal>
